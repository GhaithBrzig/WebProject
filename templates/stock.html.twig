{% extends "base.html.twig" %}
{% block title %} Stock {% endblock %}
{% block container %}

<div class="container mt-5">
    <div class="row tm-content-row">
      <div class="col-sm-14 col-md-114 col-lg-8 col-xl-8 tm-block-col">
        <div class="tm-bg-primary-dark tm-block tm-block-products">
          <h2 class="tm-block-title">Stock</h2>
           
            <input type="text" id="search" placeholder="Search" class="form-control"> 
           
          <div class="tm-product-table-container">
            
            <table class="table table-hover tm-table-small tm-product-table" id="t">
              <thead>
                <tr>
                 
                  <th scope="col"><a href="{{ path ('stock4')}}">Category <i class="fas fa-sort"></i></a></th>
                  <th scope="col"><a href="{{ path ('stock3')}}">Name <i class="fas fa-sort"></i></a></th>
                  <th scope="col">Unite</th>
                  <th scope="col"><a href="{{ path ('stock2')}}">In Stock <i class="fas fa-sort"></i></a></i></th>
                  <th scope="col">Unit Price</th>
                  <th scope="col">Total Price</th>
                  <th scope="col">Delete</th>
                  <th scope="col">Edit</th>
                  <th scope="col">&nbsp;</th>
                </tr>
              </thead>
              <tbody id="all">
                <tr {% for p in produits %}>
              
                  <td style="text-align:center"> {{p.IdCategorie.nom}} </td>
                  <td style="text-align:center"> {{p.nom}} </td>
                  <td style="text-align:center"> {{p.unite}} </td>
                  <td style="text-align:center"> {{p.quantite}} </td>
                  <td style="text-align:center"> {{p.PrixUnitaire}} </td>
                  <td style="text-align:center"> {{p.PrixTotal}} </td>
                  <td style="text-align:center">
                    <a href="{{ path('del',{'id':p.id}) }}">
                      <i class="far fa-trash-alt tm-product-delete-icon" style='font-size:20px;color:rgb(255, 255, 255)'></i>
                    </a>
                  </td>
                  <td style="text-align:center">
                    <a href="{{ path('Upd',{'id':p.id}) }}">
                        <i class="fas fa-edit" style='font-size:20px;color:yellow'></i>
                    </a>
                  </td>
                  {% if p.quantite < 6  %}
                  <td>  <div class="tm-status-circle cancelled" ></td>
                  {% endif %}
                </tr {% endfor %}>
                
              </tbody>
          
            <tbody id="searchtab">
            
            </tbody>
            </table>
          </div>

          {% if isPaginated %}
          <nav aria-label="  Page navigation example">
            <ul class="pagination">
                 {% if page == 1 %}
              <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
                  {% else %}
              <li class="page-item"><a class="page-link" href={{ path('stock', {page: page - 1, nbre: nbre}) }}>Previous</a></li>
                {% endif %}
              {% for i in range(1, nbrePage) %}
                 {% if page == i %}
                     <li class="page-item active "><a class="page-link" href={{ path('stock', {page: i, nbre: nbre}) }}>{{i}}</a></li>
                  {% else %}
                     <li class="page-item "><a class="page-link" href={{ path('stock', {page: i, nbre: nbre}) }}>{{i}}</a></li>
                {% endif %}
              {% endfor %}
              {% if page == nbrePage %}
              <li class="page-item disabled"><a class="page-link" href="#">Next</a></li>
              {% else %}
              <li class="page-item"><a class="page-link" href={{ path('stock', {page: page + 1, nbre: nbre}) }}>Next</a></li>
              {% endif %}
            </ul>
          </nav>
          {% endif %}
          <!-- table container -->
          <a
            href={{ path ('addStock')}}
            class="btn btn-primary btn-block text-uppercase mb-3">Add new product</a>
         
        </div>
      </div>
      <div class="col-sm-12 col-md-12 col-lg-4 col-xl-4 tm-block-col">
        <div class="tm-bg-primary-dark tm-block tm-block-product-categories">
          <h2 class="tm-block-title">Stock Categories</h2>
          <div class="tm-product-table-container">
            <table class="table tm-table-small tm-product-table">
              <tbody>
                <tr {% for c in categories %}>
                  <td class="tm-product-name">{{c.nom}}</td>
                  <td class="text-center">
                    <a href={{ path ('Delc',{'id':c.id})}} class="tm-product-delete-link">
                      <i class="far fa-trash-alt tm-product-delete-icon"></i>
                    </a>
                  </td>
                  <td class="text-center">
                    <a href={{ path ('Updc',{'id':c.id})}} class="tm-product-delete-link">
                      <i class="fas fa-edit" style='font-size:20px;color:yellow'></i>

                    </a>
                  </td>
                </tr {% endfor %}>
                
              </tbody>
            </table>
          </div>
          <!-- table container -->
          <a
            href={{ path ('Addc')}}
            class="btn btn-primary btn-block text-uppercase mb-3">Add new category</a>
        </div>
      </div>
    </div>
  </div>

<script
src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js">
</script>
<script>
$(document).ready(function(){
$("#search").keyup(function(){
/* La variable value va prendre la valeur insérer dans le
champ de texte
afin d’effectuer la recherche */
var value = $(this).val();
console.log("value : ")
/* Ajax est lancé lors du remplissage du champ texte dont
l’id est
« search » pour faire la recherche */
$.ajax({
/* l’url est une chaine de caractères contenant
l’adresse où la requête est
6
envoyée */
url : "{{ path('searchname') }}",
/* La méthode utilisée pour transférer les données est
GET */
type : 'GET',
/*Ici search value va prendre la chaine entrée par un
utilisateur dans la
zone de recherche et sera placée après l’url */
dataType: "json",
data: {
'searchValue' : value
},
/*Cette fonction permet de vider le contenu du tableau
pour recevoir le
nouveau contenu*/
success : function(retour){
if(retour){
console.log(retour);
$('#t tbody#searchtab').empty();
$.each(JSON.parse(retour), function(i, obj) {
$('#t tbody#all').hide();
$('#t tbody#searchtab').append('<tr><td style="text-align:center"> '+obj.idCategorie.nom+'</td><td style="text-align:center"> '+obj.nom+' </td><td style="text-align:center">'+obj.unite+ '</td><td style="text-align:center">'+obj.quantite+ '</td><td>'+obj.prixUnitaire+ '</td><td style="text-align:center">'+obj.prixTotal+ '</td><td style="text-align:center"><a href="stock/delete/'+obj.id+'" > <i class="far fa-trash-alt tm-product-delete-icon"></i></a></td><td style="text-align:center"><a href="stock/Update/'+obj.id+'"> <i class="fas fa-edit" style="font-size:20px;color:yellow" ></i></a></td> </tr>');});
}
else
{
$('#t tbody#all').show();
$('#t tbody#searchtab').empty();
$('#t tbody#searchtab').fadeIn('fast');
}
},
});
return false;
});
});
</script>
  {% endblock %}
